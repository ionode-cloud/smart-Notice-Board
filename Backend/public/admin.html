<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Smart Notice Board</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --border: #e5e7eb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            color: var(--gray-900); 
            line-height: 1.6; 
        }

        .app-container { max-width: 1400px; margin: 0 auto; padding: 2rem; min-height: 100vh; }
        .header { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 24px; padding: 2.5rem; margin-bottom: 2.5rem; box-shadow: var(--shadow-xl); border: 1px solid rgba(255, 255, 255, 0.2); position: relative; overflow: hidden; }
        .header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), var(--success), var(--warning)); }
        .header-content { display: flex; align-items: center; gap: 1.5rem; max-width: 800px; margin: 0 auto; }
        .header-icon { width: 64px; height: 64px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; box-shadow: var(--shadow-xl); }
        .header-text h1 { font-size: 2.25rem; font-weight: 700; color: var(--gray-900);text-align: center; }
        .header-text p { font-size: 1.125rem; color: var(--gray-600); font-weight: 500; }

        .status-toast { position: fixed; top: 2rem; right: 2rem; padding: 1.25rem 2rem; border-radius: 16px; color: white; font-weight: 600; font-size: 0.95rem; z-index: 1000; transform: translateX(400px); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--shadow-xl); backdrop-filter: blur(20px); }
        .status-toast.show { transform: translateX(0); }
        .status-toast.success { background: linear-gradient(135deg, var(--success), #059669); }
        .status-toast.error { background: linear-gradient(135deg, var(--danger), #dc2626); }

        .message { padding: 1rem 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; font-weight: 500; display: none; }
        .message.success { background: #ecfdf5; color: #166534; border: 1px solid #bbf7d0; }
        .message.error { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }

        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 20px; padding: 2.5rem; margin-bottom: 2rem; box-shadow: var(--shadow-lg); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), var(--success)); opacity: 0; transition: opacity 0.3s ease; }
        .card:hover { transform: translateY(-4px); box-shadow: var(--shadow-xl); }
        .card:hover::before { opacity: 1; }
        .card h2 { font-size: 1.75rem; font-weight: 700; color: var(--gray-900); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem; }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .status-badge { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.875rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }

        .form-group { margin-bottom: 1.75rem; }
        .form-label { display: block; font-weight: 600; color: var(--gray-800); font-size: 0.95rem; margin-bottom: 0.5rem; }
        .form-label small { color: var(--gray-500); font-weight: 400; }
        .file-input, .text-input { width: 100%; padding: 1rem 1.25rem; border: 2px dashed var(--gray-200); border-radius: 16px; background: var(--gray-50); font-size: 0.95rem; transition: all 0.3s ease; cursor: pointer; }
        .file-input:hover, .text-input:hover { border-color: var(--primary); background: rgba(37, 99, 235, 0.05); }

        .btn { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 1rem 2rem; border: none; border-radius: 16px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--shadow-lg); width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-xl); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .btn-danger { background: linear-gradient(135deg, var(--danger), #dc2626) !important; box-shadow: 0 4px 14px 0 rgb(239, 68, 68 / 0.4) !important; padding: 0.75rem 1.5rem !important; font-size: 0.875rem !important; width: auto !important; }

        .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 1.75rem; margin-top: 2rem; }
        .media-card { background: white; border: 2px solid var(--gray-100); border-radius: 20px; padding: 1.75rem; text-align: center; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; cursor: grab; box-shadow: var(--shadow-sm); }
        .media-card:hover { border-color: var(--primary); transform: translateY(-4px); box-shadow: var(--shadow-lg); }
        .media-card.current { border-color: var(--primary); background: linear-gradient(135deg, rgba(37, 99, 235, 0.08), rgba(37, 99, 235, 0.04)); box-shadow: 0 8px 25px rgb(37, 99, 235 / 0.2); transform: scale(1.02); }
        .media-card.featured { border-color: var(--warning); background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.04)); box-shadow: 0 8px 25px rgb(245, 158, 11 / 0.3); }
        .media-card.dragging { opacity: 0.8; transform: rotate(3deg) scale(1.03) !important; border-color: var(--success) !important; box-shadow: 0 20px 40px rgb(16, 185, 129 / 0.3) !important; }
        .position-badge { position: absolute; top: 1rem; left: 1rem; background: var(--primary); color: white; padding: 0.375rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700; z-index: 10; }
        .position-badge.current { background: var(--primary-dark); }
        .media-preview { width: 100%; height: 180px; object-fit: cover; border-radius: 16px; margin-bottom: 1rem; box-shadow: var(--shadow-md); display: block; }
        .media-title { font-weight: 600; color: var(--gray-900); margin-bottom: 0.5rem; font-size: 0.95rem; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; }
        .media-title.current, .media-title.featured { color: var(--primary); font-size: 1.05rem; font-weight: 700; }
        .media-meta { font-size: 0.8rem; color: var(--gray-500); margin-bottom: 1rem; }
        .drag-handle { cursor: grab; font-size: 1.25rem; padding: 0.75rem; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; border-radius: 12px; margin-bottom: 1rem; display: inline-flex; align-items: center; justify-content: center; width: 48px; height: 48px; user-select: none; transition: all 0.3s ease; box-shadow: var(--shadow-md); }
        .drag-handle:hover { transform: scale(1.1); }
        .drag-handle:active { cursor: grabbing; }
        .drop-zone { border: 3px dashed var(--success); background: rgba(16, 185, 129, 0.08); }
        .empty-state { grid-column: 1 / -1; text-align: center; color: var(--gray-500); padding: 4rem 2rem; }
        .empty-state i { font-size: 4rem; margin-bottom: 1rem; opacity: 0.5; }

        @media (max-width: 768px) {
            .app-container { padding: 1rem; }
            .header-content { flex-direction: column; text-align: center; }
            .header-text h1 { font-size: 1.875rem; }
            .media-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="status-toast" id="statusToast"></div>

    <div class="app-container">
        <div class="header">
            <div class="header-content">
                <div class="header-text">
                    <h1>Smart Notice Board Admin</h1>
                    <p>Manage PDFs, Images, Videos & Messages ‚Ä¢ Drag #1 for Priority</p>
                </div>
            </div>
        </div>

        <div class="message success" id="successMsg"></div>
        <div class="message error" id="errorMsg"></div>

        <!-- PDF Management -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-file-pdf"></i> PDF Documents</h2>
                <div class="status-badge" id="pdfStatus"><i class="fas fa-sync fa-spin"></i> Loading...</div>
            </div>
            <form id="pdfForm">
                <div class="form-group">
                    <label class="form-label">Upload PDF Document<small>Drag #1 to top for priority rotation</small></label>
                    <input type="file" name="pdf" accept=".pdf" class="file-input" required>
                </div>
                <button type="submit" class="btn"><i class="fas fa-cloud-upload-alt"></i> Upload PDF</button>
            </form>
            <div id="pdfList" class="media-grid">
                <div class="empty-state"><i class="far fa-file-pdf"></i><div>No PDF documents</div><small>Upload PDFs for rotation display</small></div>
            </div>
        </div>

        <!-- Image Management -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-images"></i> Image Slideshow</h2>
            </div>
            <form id="imageForm">
                <div class="form-group">
                    <label class="form-label">Upload Images<small>Max 10 images ‚Ä¢ Drag to reorder</small></label>
                    <input type="file" name="images" accept="image/*" multiple class="file-input">
                </div>
                <button type="submit" class="btn"><i class="fas fa-images"></i> Upload Images</button>
            </form>
            <div id="imageList" class="media-grid">
                <div class="empty-state"><i class="far fa-images"></i><div>No images</div><small>Upload images for slideshow</small></div>
            </div>
        </div>

        <!-- Video Management -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-video"></i> Video Content</h2>
                <div class="status-badge" id="videoStatus"><i class="fas fa-sync fa-spin"></i> Loading...</div>
            </div>
            <form id="videoForm">
                <div class="form-group">
                    <label class="form-label">Upload Video<small>Drag #1 to top for priority rotation</small></label>
                    <input type="file" name="video" accept="video/*" class="file-input" required>
                </div>
                <button type="submit" class="btn"><i class="fas fa-video"></i> Upload Video</button>
            </form>
            <div id="videoList" class="media-grid">
                <div class="empty-state"><i class="far fa-file-video"></i><div>No videos</div><small>Upload videos for rotation display</small></div>
            </div>
        </div>

        <!-- Messages Management -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-scroll"></i> Marquee Messages</h2>
                <div class="status-badge" id="messageStatus"><i class="fas fa-sync fa-spin"></i> Loading...</div>
            </div>
            <form id="messageForm">
                <div class="form-group">
                    <label class="form-label">Add Marquee Message<small>Max 100 chars - Shows in bottom ticker</small></label>
                    <input type="text" name="text" maxlength="100" class="text-input" placeholder="e.g. MCA Placement Drive Tomorrow!" required>
                </div>
                <button type="submit" class="btn"><i class="fas fa-plus"></i> Add Message</button>
            </form>
            <div id="messageList" class="media-grid">
                <div class="empty-state"><i class="far fa-comment"></i><div>No messages</div><small>Add your first marquee message</small></div>
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ PERFECT API ENDPOINT MATCHING YOUR server.js
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'https://smart-notice-board-a.onrender.com/api' 
            : `${window.location.protocol}//${window.location.host}/api`;

        console.log('üîó API_BASE:', API_BASE);

        let pdfs = [], images = [], videos = [], messages = [];

        // Status notifications
        function showStatus(message, type = 'success') {
            const toast = document.getElementById('statusToast');
            toast.textContent = message;
            toast.className = `status-toast show ${type}`;
            setTimeout(() => toast.classList.remove('show'), 4000);
        }

        function updateStatusBadge(type, count) {
            const badge = document.getElementById(`${type}Status`);
            badge.innerHTML = count > 0 
                ? `<i class="fas fa-check-circle"></i> ${type.toUpperCase()}: ${count}`
                : `<i class="fas fa-pause-circle"></i> No ${type}`;
        }

        // ‚úÖ PDF FUNCTIONS - MATCHES YOUR ENDPOINTS
        async function loadPDFs() {
            const list = document.getElementById('pdfList');
            try {
                const response = await fetch(`${API_BASE}/pdf`);
                pdfs = await response.json();
                list.innerHTML = pdfs.length ? pdfs.map((pdf, index) => {
                    const isCurrent = index === 0;
                    return `
                        <div class="media-card ${isCurrent ? 'current' : ''}" draggable="true" data-id="${pdf._id}">
                            <div class="position-badge ${isCurrent ? 'current' : ''}">#${index + 1}</div>
                            <div class="drag-handle" draggable="false"><i class="fas fa-grip-vertical"></i></div>
                            <div class="media-preview" style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-file-pdf" style="font-size: 3rem; color: #dc2626;"></i>
                            </div>
                            <div class="media-title ${isCurrent ? 'current' : ''}">${pdf.filename}${isCurrent ? ' ‚Ä¢ Next' : ''}</div>
                            <div class="media-meta">${new Date(pdf.uploadedAt).toLocaleString()}</div>
                            <button class="btn btn-danger" onclick="deleteMedia('${pdf._id}', 'pdfs')"><i class="fas fa-trash"></i> Delete</button>
                        </div>`;
                }).join('') : `<div class="empty-state"><i class="far fa-file-pdf"></i><div>No PDFs</div><small>Upload PDFs for rotation</small></div>`;
                updateStatusBadge('pdf', pdfs.length);
                initDragDrop('pdfList', 'pdfs');
            } catch (error) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><div>Error loading PDFs</div></div>';
            }
        }

        // ‚úÖ IMAGE FUNCTIONS
        async function loadImages() {
            const list = document.getElementById('imageList');
            try {
                const response = await fetch(`${API_BASE}/images`);
                images = await response.json();
                list.innerHTML = images.length ? images.map((img, index) => `
                    <div class="media-card ${index === 0 ? 'featured' : ''}" draggable="true" data-id="${img._id}">
                        <div class="position-badge">#${index + 1}</div>
                        <div class="drag-handle" draggable="false"><i class="fas fa-grip-vertical"></i></div>
                        <img src="${img.cloudinary_url}" alt="${img.filename}" class="media-preview" onerror="this.style.display='none';this.nextSibling.style.display='flex'">
                        <div class="media-preview" style="display:none; background: var(--gray-100); align-items: center; justify-content: center;"><i class="fas fa-image" style="font-size:3rem;color:var(--gray-400)"></i></div>
                        <div class="media-title ${index === 0 ? 'featured' : ''}">${img.filename}</div>
                        <div class="media-meta">${new Date(img.uploadedAt).toLocaleString()}</div>
                        <button class="btn btn-danger" onclick="deleteMedia('${img._id}', 'images')"><i class="fas fa-trash"></i> Delete</button>
                    </div>
                `).join('') : `<div class="empty-state"><i class="far fa-images"></i><div>No images</div><small>Upload images for slideshow</small></div>`;
                initDragDrop('imageList', 'images');
            } catch (error) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><div>Error loading images</div></div>';
            }
        }

        // ‚úÖ VIDEO FUNCTIONS
        async function loadVideos() {
            const list = document.getElementById('videoList');
            try {
                const response = await fetch(`${API_BASE}/videos`);
                videos = await response.json();
                list.innerHTML = videos.length ? videos.map((video, index) => {
                    const isCurrent = index === 0;
                    return `
                        <div class="media-card ${isCurrent ? 'current' : ''}" draggable="true" data-id="${video._id}">
                            <div class="position-badge ${isCurrent ? 'current' : ''}">#${index + 1}</div>
                            <div class="drag-handle" draggable="false"><i class="fas fa-grip-vertical"></i></div>
                            <video src="${video.cloudinary_url}" muted class="media-preview" preload="metadata"></video>
                            <div class="media-title ${isCurrent ? 'current' : ''}">${video.filename}${isCurrent ? ' ‚Ä¢ Next' : ''}</div>
                            <div class="media-meta">${new Date(video.uploadedAt).toLocaleString()}</div>
                            <button class="btn btn-danger" onclick="deleteMedia('${video._id}', 'videos')"><i class="fas fa-trash"></i> Delete</button>
                        </div>`;
                }).join('') : `<div class="empty-state"><i class="far fa-file-video"></i><div>No videos</div><small>Upload videos for rotation</small></div>`;
                updateStatusBadge('video', videos.length);
                initDragDrop('videoList', 'videos');
            } catch (error) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><div>Error loading videos</div></div>';
            }
        }

        // ‚úÖ MESSAGES FUNCTIONS
        async function loadMessages() {
            const list = document.getElementById('messageList');
            try {
                const response = await fetch(`${API_BASE}/messages`);
                messages = await response.json();
                list.innerHTML = messages.length ? messages.map((msg, index) => `
                    <div class="media-card ${index === 0 ? 'current' : ''}" data-id="${msg._id}">
                        <div class="position-badge ${index === 0 ? 'current' : ''}">#${index + 1}</div>
                        <div class="drag-handle" draggable="false"><i class="fas fa-grip-vertical"></i></div>
                        <div class="media-preview" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-scroll" style="font-size: 3rem; color: white;"></i>
                        </div>
                        <div class="media-title ${index === 0 ? 'current' : ''}">${msg.text}</div>
                        <div class="media-meta">${new Date(msg.createdAt).toLocaleString()}</div>
                        <button class="btn btn-danger" onclick="deleteMedia('${msg._id}', 'messages')"><i class="fas fa-trash"></i> Delete</button>
                    </div>
                `).join('') : `<div class="empty-state"><i class="far fa-comment"></i><div>No messages</div><small>Add your first marquee message</small></div>`;
                updateStatusBadge('message', messages.length);
            } catch (error) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><div>Error loading messages</div></div>';
            }
        }

        // ‚úÖ DELETE FUNCTION - MATCHES YOUR ENDPOINTS
        window.deleteMedia = async (id, endpoint) => {
            if (confirm(`Delete this item?`)) {
                try {
                    const response = await fetch(`${API_BASE}/${endpoint}/${id}`, { method: 'DELETE' });
                    if (!response.ok) throw new Error('Delete failed');
                    showStatus('‚úÖ Deleted successfully!');
                    if (endpoint === 'pdfs') loadPDFs();
                    if (endpoint === 'images') loadImages();
                    if (endpoint === 'videos') loadVideos();
                    if (endpoint === 'messages') loadMessages();
                } catch (error) {
                    showStatus('‚ùå Delete failed', 'error');
                }
            }
        };

        // ‚úÖ DRAG & DROP - MATCHES YOUR PATCH ENDPOINTS
        function initDragDrop(listId, endpoint) {
            const list = document.getElementById(listId);
            let draggedItem = null;

            list.addEventListener('dragstart', (e) => {
                if (e.target.closest('.media-card')) {
                    draggedItem = e.target.closest('.media-card');
                    draggedItem.classList.add('dragging');
                }
            });

            list.addEventListener('dragend', () => {
                if (draggedItem) {
                    draggedItem.classList.remove('dragging');
                    updateOrder(listId, endpoint);
                    draggedItem = null;
                }
            });

            list.addEventListener('dragover', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(list, e.clientY);
                [...list.querySelectorAll('.media-card')].forEach(item => item.classList.remove('drop-zone'));
                if (afterElement) afterElement.classList.add('drop-zone');
            });

            list.addEventListener('drop', (e) => {
                e.preventDefault();
                [...list.querySelectorAll('.media-card')].forEach(item => item.classList.remove('drop-zone'));
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.media-card:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) return { offset, element: child };
                return closest;
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        async function updateOrder(listId, endpoint) {
            const list = document.getElementById(listId);
            const ids = [...list.querySelectorAll('.media-card')].map(item => item.dataset.id);
            try {
                await fetch(`${API_BASE}/${endpoint}`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ order: ids })
                });
                showStatus('‚úÖ Order saved!');
            } catch (error) {
                console.error('Order update failed:', error);
            }
        }

        // ‚úÖ FORM HANDLERS - PERFECT ENDPOINT MATCH
        document.getElementById('pdfForm').addEventListener('submit', handleFormSubmit);
        document.getElementById('imageForm').addEventListener('submit', handleFormSubmit);
        document.getElementById('videoForm').addEventListener('submit', handleFormSubmit);
        document.getElementById('messageForm').addEventListener('submit', handleMessageForm);

        async function handleFormSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('.btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            btn.disabled = true;

            try {
                const formData = new FormData(form);
                const endpoint = form.id === 'pdfForm' ? 'pdf' : form.id.replace('Form', 's');
                const response = await fetch(`${API_BASE}/${endpoint}`, { method: 'POST', body: formData });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Upload failed');
                }
                
                showStatus('‚úÖ Upload successful!');
                form.reset();
                if (endpoint === 'pdf') loadPDFs();
                if (endpoint === 'images') loadImages();
                if (endpoint === 'videos') loadVideos();
            } catch (error) {
                showStatus(`‚ùå ${error.message}`, 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function handleMessageForm(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const text = formData.get('text');
            
            const btn = e.target.querySelector('.btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            btn.disabled = true;

            try {
                const response = await fetch(`${API_BASE}/messages`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                
                if (!response.ok) throw new Error('Failed to add message');
                showStatus('‚úÖ Message added!');
                e.target.reset();
                loadMessages();
            } catch (error) {
                showStatus('‚ùå Failed to add message', 'error');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        // ‚úÖ INIT
        async function init() {
            loadPDFs();
            loadImages();
            loadVideos();
            loadMessages();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Auto refresh
        setInterval(() => {
            loadPDFs();
            loadVideos();
            loadMessages();
        }, 15000);
    </script>
</body>
</html>
